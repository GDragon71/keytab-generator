# Kerberos Keytab Generator

A standalone Python tool for generating and inspecting Kerberos keytab files without access to a KDC (Key Distribution Center).

## Features

- ✓ Generate keytab files from SPN, domain, and password
- ✓ Read and inspect keytab file contents
- ✓ Validate keytab binary format
- ✓ Works offline (no network/KDC required)
- ✓ Cross-platform support (Linux, macOS, Windows)
- ✓ AES256-CTS-HMAC-SHA1-96 encryption (modern standard)
- ✓ Secure password input (hidden from screen)

## Installation

### Requirements

- Python 3.6+
- cryptography library

### Setup

1. Clone or download this repository
2. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```

## Usage

### Generate a Keytab File

Generate a keytab by providing domain and SPN. Password will be prompted (hidden):

```bash
python3 keytab.py --domain EXAMPLE.COM --spn HTTP/server.example.com
```

Optional: Specify output file path (defaults to auto-named file in current directory):

```bash
python3 keytab.py --domain EXAMPLE.COM --spn HTTP/server.example.com --output mykey.keytab
```

**Arguments:**
- `--domain REALM` - Kerberos realm/domain (e.g., `EXAMPLE.COM`)
- `--spn PRINCIPAL` - Service Principal Name (e.g., `HTTP/server.example.com`)
- `--output FILE` - Optional output file path (auto-named if omitted)

**Output:**
- Success message with file details
- Auto-generated filename format: `SERVICE_HOSTNAME.keytab` or `SERVICE.keytab`
- Automatic validation of generated keytab

### Read/Inspect a Keytab File

Parse and display keytab contents:

```bash
python3 keytab.py --read mykey.keytab
```

Shows:
- Keytab version
- Principal name (realm + components)
- Encryption algorithm
- Key version number
- Timestamp
- Key length

## Examples

### Example 1: Generate a keytab for an HTTP service

```bash
$ python3 keytab.py --domain EXAMPLE.COM --spn HTTP/web.example.com
Enter password for service account: 
Generating keytab...
✓ Keytab file generated successfully: HTTP_web.keytab
  File size: 94 bytes
  Realm: EXAMPLE.COM
  Principal: HTTP/web.example.com
  Encryption: AES256-CTS-HMAC-SHA1-96

Verifying keytab format...
Keytab Version: 0x0502
----
Entry 1:
  Principal: HTTP/web.example.com@EXAMPLE.COM
  Encryption Type: AES256-CTS-HMAC-SHA1-96
  Key Version: 0
  Timestamp: 2026-02-22 12:34:56 UTC
  Key Length: 32 bytes

✓ Keytab validation passed
```

### Example 2: Generate with custom output path

```bash
$ python3 keytab.py --domain CORP.LOCAL --spn LDAP/dc.corp.local --output /etc/krb5.keytab
Enter password for service account: 
Generating keytab...
✓ Keytab file generated successfully: /etc/krb5.keytab
  ...
```

### Example 3: Inspect a keytab file

```bash
$ python3 keytab.py --read /etc/krb5.keytab
Keytab Version: 0x0502
----
Entry 1:
  Principal: LDAP/dc.corp.local@CORP.LOCAL
  Encryption Type: AES256-CTS-HMAC-SHA1-96
  Key Version: 0
  Timestamp: 2026-02-22 10:15:00 UTC
  Key Length: 32 bytes
```

## Testing Without a KDC

This tool is designed for offline testing:

1. **Generate a keytab** with your test domain, SPN, and password
2. **Inspect the keytab** with `--read` to verify structure and contents
3. **Use the keytab** for testing without any network connection required

No KDC, network access, or Kerberos infrastructure needed for keytab generation or inspection.

## Security Notes

- **Password Handling**: Passwords are only used to derive cryptographic keys locally. They are never stored in the keytab file or transmitted.
- **Keytab Files**: Generated keytab files contain sensitive cryptographic material. Protect them as you would passwords.
- **Permissions**: On Unix-like systems, restrict file permissions: `chmod 600 keytab.keytab`
- **Storage**: Keep keytab files in secure locations with restricted access.

## Technical Details

### Keytab Format

Generated keytabs follow RFC 3961 Kerberos Format Specification:
- File format version: 5.2 (0x0502)
- Encryption: AES256-CTS-HMAC-SHA1-96
- Key derivation: PBKDF2-HMAC-SHA1 with 4096 iterations
- Salt format: `{REALM}{SERVICE}`

### Exit Codes

- `0` - Success
- `1` - Error (validation failed, file issues, etc.)

## Troubleshooting

### "cryptography library not found"
Install dependencies:
```bash
pip install cryptography
```

### File permission denied
Ensure you have write permissions to the output directory.

### Import errors on different Python versions
Use Python 3.6 or newer and ensure cryptography is properly installed for your Python version.

## License

MIT

## Notes

- This tool generates keytab files for testing and legitimate administrative purposes only.
- Keytabs generated by this tool are compatible with Kerberos clients and services.
- For production use, consider using official Kerberos tools (ktutil, kadmin) when access to a KDC is available.

